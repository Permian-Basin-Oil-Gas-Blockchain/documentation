## Node and SGX backup

### Node Backup Procedure

Generate backup file to restore SKALE node on another machine

```bash
skale node backup [BACKUP_FOLDER_PATH]

```

Arguments:

  - `BACKUP_FOLDER_PATH` - path to the folder where the backup file will be saved

#### Node initialization from backup

Restore SKALE node on another machine

```bash
skale node restore [BACKUP_PATH] [ENV_FILE]

```

Arguments:

  - `BACKUP_PATH` - path to the archive with backup data generated by `skale node backup` command
  - `ENV_FILE` - path to .env file (required parameters are listed in the `skale init` command)


### SGXWallet Backup Procedure

When SGXWallet is initialized, the server will print the backup key. 
**This key must be securely recorded and stored.**
Be sure to store this key in a safe place, then go into a docker container and securely remove it with the following command:

```bash
docker exec -it <SGX_CONTAINER_NAME> bash && apt-get install secure-delete && srm -vz backup_key.txt
```

Master-Slave replication is recommended to support the SGXWallet backup strategy. Below are general instructions for a basic backup and recovery process.

#### Backup SGXWallet (manual copy)

1.  Stop the container:

```bash
docker-compose down
```

2.  Copy the entire `sgx_data` directory.

#### Recover from backup

1.  Edit the `docker-compose.yml` and add the `-b` flag to recover from backup.

```yaml
command: -s -y -d -b
```

2.  Edit the `docker-compose.yml` and add `stdin_open: true` option. For example:

```yaml
version: "3"
services:
  sgxwallet:
    image: skalenetwork/sgxwallet:[version]
    stdin_open: true
```

3.  Copy the backed up `sgx_data` directory to the recovery `sgx_data` directory.
4.  Execute:

```bash
docker-compose up -d
```

5.  Open another terminal window and run `docker attach container_name` there.
6.  Enter the backup key when prompted.
7.  Edit the `docker-compose.yml` file, remove the `-b` flag and `stdin_open: true` option.
